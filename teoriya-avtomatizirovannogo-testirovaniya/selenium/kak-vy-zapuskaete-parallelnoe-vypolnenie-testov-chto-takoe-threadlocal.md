# –ö–∞–∫ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤? –ß—Ç–æ —Ç–∞–∫–æ–µ ThreadLocal?

### üîπ –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤:

1.  **Pytest + `pytest-xdist`**

    * –°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è Python.
    * –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `-n` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤).

    ```bash
    pytest -n 4   # –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç—ã –≤ 4 –ø–æ—Ç–æ–∫–∞—Ö
    ```

    Pytest —Å–∞–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–µ—Å—Ç—ã –ø–æ –≤–æ—Ä–∫–µ—Ä–∞–º.
2. **Selenium Grid**
   * –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö (–±—Ä–∞—É–∑–µ—Ä—ã, –û–°).
   * –í –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å `pytest-xdist` –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
3. **Threading / multiprocessing –≤ Python**
   * –ú–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ (`threading`, `multiprocessing`).
   * –ù–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pytest, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å —Å–≤–æ–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –ø–æ—Ç–æ–∫–æ–≤.

***

### üîπ –ü—Ä–æ–±–ª–µ–º–∞ —Å WebDriver –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤, —Ç–æ:

* –≤—Å–µ —Ç–µ—Å—Ç—ã –±—É–¥—É—Ç –ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –¥—Ä–∞–π–≤–µ—Ä**,
* –±—Ä–∞—É–∑–µ—Ä—ã –±—É–¥—É—Ç ¬´–º–µ—à–∞—Ç—å¬ª –¥—Ä—É–≥ –¥—Ä—É–≥—É.

–†–µ—à–µ–Ω–∏–µ: —É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Å–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –¥—Ä–∞–π–≤–µ—Ä–∞**.

***

### üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ **ThreadLocal**?

`ThreadLocal` ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ **–æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞**.

–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Selenium —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ **–∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä WebDriver**, –∏ –æ–Ω–∏ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π.

–ü—Ä–∏–º–µ—Ä –≤ Python (–∞–Ω–∞–ª–æ–≥ `ThreadLocal`):

```python
import threading
from selenium import webdriver

# –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤
thread_local = threading.local()

def get_driver():
    if not hasattr(thread_local, "driver"):
        # —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç–æ–∫–∞
        thread_local.driver = webdriver.Chrome()
    return thread_local.driver

def test_google():
    driver = get_driver()
    driver.get("https://google.com")
    print(driver.title)
    driver.quit()

# –ó–∞–ø—É—Å—Ç–∏–º —Ç–µ—Å—Ç—ã –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö
threads = []
for _ in range(3):
    t = threading.Thread(target=test_google)
    threads.append(t)
    t.start()

for t in threads:
    t.join()
```

üëâ –ó–¥–µ—Å—å —É –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–≤–æ–π `driver`, –±–ª–∞–≥–æ–¥–∞—Ä—è `threading.local()` (–∞–Ω–∞–ª–æ–≥ **ThreadLocal** –≤ Java).

***

### üîπ –ò—Ç–æ–≥–æ

* –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ª—É—á—à–µ –≤—Å–µ–≥–æ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ **pytest-xdist** –∏–ª–∏ **Selenium Grid**.
* **ThreadLocal** –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –≤ –∫–∞–∂–¥–æ–º –ø–æ—Ç–æ–∫–µ –±—ã–ª **—Å–≤–æ–π WebDriver**, –∏–Ω–∞—á–µ –±—Ä–∞—É–∑–µ—Ä—ã –±—É–¥—É—Ç –º–µ—à–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É.
